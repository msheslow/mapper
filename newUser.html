<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="node_modules/bulma/css/bulma.css" />
        <link rel="stylesheet" href="custom_style.css"/>
        <link href="https://fonts.googleapis.com/css?family=Shrikhand&display=swap" rel="stylesheet">
        <title>Mapper | Create Account</title>
    </head>
<body>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="node_modules/axios/dist/axios.min.js"></script>
        <script src="https://kit.fontawesome.com/3e308f3171.js" crossorigin="anonymous"></script>

        <main>
        <div id="root">
            <div class="pageHeader" id="fixedHeader">
                <a href="./index.html" class="titleLogo title">Mapper&nbsp&nbsp<i class="fas fa-route"></i></a>
                    <div class="header-right">
                        <a href="./login.html" class="button top is-rounded">Get started</a>
                        <a href="./user.html" class="userIcon"><i class="fas fa-user"></i></a>
                    </div>
            </div>
            <div class="content" style="min-height: 1000px; margin-top: 50px;">
                <div style="text-align: center;">
                    <span style="font-size: 40px; color: black;"><b>Create Account</b></span>
                    <form><br>
                        <label style="color: black;" for="firstname">First Name</label><br>
                        <input class="input is-small is-rounded" style="width: 250px;" type="text" id="firstname" name="firstname">
                        <br><br>
                        <label style="color: black;" for="lastname">Last Name</label><br>
                        <input class="input is-small is-rounded" style="width: 250px;" type="text" id="lastname" name="lastname">
                        <br><br>
                        <label style="color: black;" for="username">Username</label><br>
                        <input class="input is-small is-rounded" style="width: 250px;" type="text" id="username" name="username">
                        <br><br>
                        <label style="color: black;" for="password">Password</label><br>
                        <input class="input is-small is-rounded" style="width: 250px;" type="text" id="password" name="password">
                    </form>
                    <br>
                    <button class="button" style="width: 150px;" id="createAccountButton">Create Account</button>
                </div>
            </div>
        </div>
        <script>
           async function createAccountButtonHandler(event){
            try{
            event.preventDefault();
                let result= await axios.post('https://mapper-project.herokuapp.com/createlogin', { user: $('#username').val(),
                password: $('#password').val() }, { headers: {'Access-Control-Allow-Origin': '*'}});
                document.cookie = "username=" + result.data;
                console.log("Created a new user and set cookie")
                window.location.replace("https://mapper-project.herokuapp.com/index.html"); // redirect to index.html after login
            } catch {
                 window.alert("This username and password already exists! Return to login page or create a new account with different credentials.")
            }
            }

            $('main').on('click', '#createAccountButton', createAccountButtonHandler);
        </script>
        </main>
</body>
</html>