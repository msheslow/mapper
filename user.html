<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="node_modules/bulma/css/bulma.css" />
        <link rel="stylesheet" href="custom_style.css"/>
        <link href="https://fonts.googleapis.com/css?family=Shrikhand&display=swap" rel="stylesheet">
        <title>Mapper | My Trips</title>
    </head>
    <body>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="node_modules/axios/dist/axios.min.js"></script>
        <script src="https://kit.fontawesome.com/3e308f3171.js" crossorigin="anonymous"></script>

        <main>
        <div id="root">
            <div class="pageHeader" id="fixedHeader">
                <a href="./index.html" class="titleLogo title">Mapper&nbsp&nbsp<i class="fas fa-route"></i></a>
                    <div class="header-right">
                        <a href="./login.html" class="button top is-rounded">Get started</a>
                        <a href="./user.html" class="userIcon"><i class="fas fa-user"></i></a>
                    </div>
            </div>
            <div class="content">
                <div class="columns" style="min-height: 1000px; margin: 10px;">
                    <div class="column is-three-quarters">
                        <span style="font-size: 32px; color: black;">My Trips</span>
                        <div id="userTrips">


                        </div>
                    </div>
                    <div id="userInfo" class="column is-one-quarter">

                        <br><br>
                        <div class="box" style="margin-top: 10px;">
                            <div style="text-align: center;">
                            <span style="font-size: 80px; color: black;"><i class="fas fa-user-circle"></i></span><br><br>
                            <span style="font-size: 20px; color: black;">Username</span>
                            </div>
                            
                    </div>
                </div>
            </div>
        </div>

        </main>


        <script>
        function tripCardAssembler(aTrip, aTripID){
            return (`<div class="box" style="margin-top: 10px;">
                        <div class="columns">
                            <div class="column is-2">
                                <span style="font-size: 18px; color: gray;">Trip ID: ${aTripID}</span>
                                <br>
                                <span style="font-size: 50px;"><i class="fas fa-car-side"></i></span>
                            </div>
                            <div class="column is-6">
                                <span style="font-size: 25px;">${aTrip.data.rows[0].startLocation} <i style="font-size: 40px;" class="fas fa-long-arrow-alt-right"></i> ${aTrip.data.rows[0].endLocation}</span>
                            </div>
                            <div class="column is-2" style="text-align: center;">
                                <span style="font-size: 18px; color: gray;">${aTrip.data.rows.length} stops</span><br><br>
                            </div>
                            <div class="column is-2" style="text-align: center;">
                                <button class="button is-small is-rounded" id="editTrip" num="${aTrip.tripID}">Edit Trip</button><br><br>
                                <button class="button del is-small is-rounded" id="deleteTrip" num="${aTrip.tripID}"><i class="far fa-trash-alt"></i>
                            </div>
                        </div>
                    </div>`)

        }

        async function loadTrips() {
            let result= await axios.get('https://mapper-project.herokuapp.com/tripids', { headers: {'Access-Control-Allow-Origin': '*'}});
            console.log("result")
            console.log(result)
            console.log("result.data.rows")
            console.log(result.data.rows)
            console.log("result.data.rows[0].tripID")
            console.log(result.data.rows[0].tripID)
            console.log("result.data.rows.length")
            console.log(result.data.rows.length)
            for (i=0; i < result.data.rows.length; i++) {
                let aTrip = await axios.get('https://mapper-project.herokuapp.com/gettrip/' + result.data.rows[i].tripID, { headers: {'Access-Control-Allow-Origin': '*'}});
                console.log("aTrip")
                console.log(aTrip);
                $('#userTrips').append(tripCardAssembler(aTrip, result.data.rows[i].tripID));
            }
        }

        async function renderTrips() {
            loadTrips();
        }

        window.onload = renderTrips();
        </script>

    </body>

</html>